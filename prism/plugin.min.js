!function(){"use strict";tinymce.PluginManager.requireLangPack("prism"),tinymce.PluginManager.add("prism",function(e){function t(){var t,a,n,i,r,l=e.dom,o=e.selection,c={},g="markup",s="",u=e.settings.prism_languages,d=[{text:"HTML/XML",value:"markup"},{text:"CSS",value:"css"},{text:"C-like",value:"clike"},{text:"JavaScript",value:"javascript"}],m=u?u:d;return r=o.getContent({format:"text"}),c.code=r,""==c.code&&(s="<br>"),"&nbsp;"==c.code&&(c.code=""),{title:"Prism - Code Editor",minWidth:450,body:{type:"panel",items:[{type:"selectbox",name:"language",label:"Select language",items:m,flex:!0},{type:"textarea",name:"code",minHeight:200,multiline:!0,placeholder:"Please insert your code."},{type:"checkbox",name:"linenumber",label:"Line Number"},{type:"grid",columns:2,items:[{type:"input",name:"firstline",label:"First Line",disabled:!1},{type:"input",name:"highlight",label:"Highlight",disabled:!1}]}]},initialData:{code:c.code,linenumber:!0},onChange:function(e){var t=e.getData(),a=t.linenumber?e.enable:e.disable;a("firstline"),a("highlight")},onSubmit:function(r){if(""===r.getData().code)return void tinyMCE.activeEditor.windowManager.alert("Please insert your code.");var o=r.getData().code;o=o.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/　{4}/g,"	");var c=r.getData().language?r.getData().language:g,u=r.getData().firstline?r.getData().firstline:"",d=r.getData().linenumber?r.getData().linenumber:!1,m=r.getData().highlight?r.getData().highlight:"";t=l.create("code",{"class":"language-"+c},o),d&&(a=' class="line-numbers"'),""!=u&&(n=' data-start="'+u+'"'),""!=m&&(i=' data-line="'+m+'"'),void 0===a?e.insertContent("<pre>"+l.getOuterHTML(t)+"</pre>"+s):e.insertContent("<pre"+a+n+i+">"+l.getOuterHTML(t)+"</pre>"+s),r.close()},buttons:[{text:"Close",type:"cancel",onclick:"close"},{text:"Insert",type:"submit",primary:!0,enabled:!1}]}}function a(){var a=e.selection,n=a.getNode();if("code"===n.nodeName.toLowerCase()){var i=$(n).unwrap().text();i=i.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\n{2}/g,"<p>").replace(/\n/g,"<br>").replace(/ /g,"&nbsp;").replace(/\t/g,"　　　　"),a.setContent(i),n.remove()}else e.windowManager.open(t())}return e.ui.registry.addToggleButton("prism",{icon:"code-sample",tooltip:"Insert code with Prism",onAction:a,onSetup:function(t){var a=function(e){t.setActive("code"===e.element.nodeName.toLowerCase())};return e.on("NodeChange",a),function(){e.off("NodeChange",a)}}}),e.ui.registry.addMenuItem("prism",{text:"Prism",icon:"code-sample",onAction:a}),{getMetadata:function(){return{name:"Prism",url:"https://github.com/holydragoonjp/Prism-for-TinyMCE5"}}}})}();